<!DOCTYPE html>
<html>
    <head>
        <title><%= title %></title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel='stylesheet' href='/stylesheets/style.css' />
        <link rel="manifest" href="/manifest.json">
        <script type="module" src="https://cdn.jsdelivr.net/npm/@pwabuilder/pwaauth@latest/dist/pwa-auth.min.js"></script> 
        <script type="module" src="/pwabuilder-sw-register.js"></script>
        <link href='https://fonts.googleapis.com/css?family=Roboto' rel='stylesheet'>
    </head>
    <body>
        <div class="container">

            <div id="banner">
                <div id="logo">
                    <img style="height: 100%; opacity: 0.5" src="./images/uclLogo.svg">
                </div>
                <div id="logo">
                    <img style="height: 100%" src="./images/msLogo.png">
                </div>
                <div id="logo">
                    <img style="height: 100%; opacity: 0.5" src="./images/uclGOSLogo.png">
                </div>
                
            </div>

            <div style="margin-top: 25vh;" id="titleBox">
                <h1><%= title %></h1>
            </div>

            <div id="navButtonContainer">
                <div id="signIn" style="margin: 5vh">
                    <pwa-auth 
                        id="auth" style="display: block" 
                        microsoftkey="9b12a7f3-2f91-4e05-8bc2-2a1bc3c5a710"
                        
                        >
                    </pwa-auth>
                </div>
            </div>
            
            
            

            <script>
                if (!(navigator.onLine)) {
                    console.log('offline');
                    document.getElementById('signIn').innerHTML = "Please go online to sign in";
                } else {
                    document.getElementById('signIn').innerHTML = '<pwa-auth id="auth" style="display: block" microsoftkey="9b12a7f3-2f91-4e05-8bc2-2a1bc3c5a710"></pwa-auth>';
                }


                const pwaAuth = document.querySelector("pwa-auth");
                pwaAuth.addEventListener("signin-completed", ev => {
                    const signIn = ev.detail;
                    if (signIn.error) {
                        console.error("Sign in failed", signIn.error);
                    } else {
                    var email = signIn.email;
                    var name = signIn.name;
                    var token = signIn.providerData.accessToken;
                    var expiration_date = new Date();
                    expiration_date.setFullYear(expiration_date.getFullYear() + 1);
                    // console.log("Access token: ", token);
                    // console.log("Email: ", email);
                    // console.log("Name: ", name);
                    // console.log("providerData: ", signIn.providerData);
                    document.cookie="accessToken=" + token + "; expires=" + expiration_date.toUTCString();
                    document.getElementById("email").innerHTML += "<input type='hidden' name='email' value='" + email + "'>";
                    document.getElementById("token").innerHTML += "<input type='hidden' name='token' value='" + token + "'>";
                    //   document.getElementById("name").innerHTML += "<input type='hidden' name='name' value='" + name + "'>";
                    document.forms['checker'].submit();
                    }
                })

//                 var words = document.getElementsByClassName('word');
// var wordArray = [];
// var currentWord = 0;

// words[currentWord].style.opacity = 1;
// for (var i = 0; i < words.length; i++) {
//   splitLetters(words[i]);
// }

// function changeWord() {
//   var cw = wordArray[currentWord];
//   var nw = currentWord == words.length-1 ? wordArray[0] : wordArray[currentWord+1];
//   for (var i = 0; i < cw.length; i++) {
//     animateLetterOut(cw, i);
//   }
  
//   for (var i = 0; i < nw.length; i++) {
//     nw[i].className = 'letter behind';
//     nw[0].parentElement.style.opacity = 1;
//     animateLetterIn(nw, i);
//   }
  
//   currentWord = (currentWord == wordArray.length-1) ? 0 : currentWord+1;
// }

// function animateLetterOut(cw, i) {
//   setTimeout(function() {
// 		cw[i].className = 'letter out';
//   }, i*80);
// }

// function animateLetterIn(nw, i) {
//   setTimeout(function() {
// 		nw[i].className = 'letter in';
//   }, 340+(i*80));
// }

// function splitLetters(word) {
//   var content = word.innerHTML;
//   word.innerHTML = '';
//   var letters = [];
//   for (var i = 0; i < content.length; i++) {
//     var letter = document.createElement('span');
//     letter.className = 'letter';
//     letter.innerHTML = content.charAt(i);
//     word.appendChild(letter);
//     letters.push(letter);
//   }
  
//   wordArray.push(letters);
// }

// changeWord();
// setInterval(changeWord, 4000);
            </script>

            <form action="/loginUser/verify" method="POST" name="checker">
                <a id="email"></a>
                <a id="token"></a>
                <!-- <a id="name"></a> -->
            </form>
        </div>




    </body>
</html>